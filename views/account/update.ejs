<h1><%= title %></h1>

<% /* Flash messages (success / failure) */ %>
<% if (typeof messages === "function") { 
  const flashHtml = messages();
  if (flashHtml) { %>
    <div class="flash-message">
      <%- flashHtml %>
    </div>
<%  } 
} %>

<% /* Server-side validation errors (from express-validator) */ %>
<% if (errors && errors.length > 0) { %>
  <div class="notice">
    <ul>
      <% errors.forEach(err => { %>
        <li><%= err.msg %></li>
      <% }) %>
    </ul>
  </div>
<% } %>

<main id="account-update-page">
  <section class="account-update-panel">
    <h2>Account Update</h2>

    <!-- =======================
         1) ACCOUNT UPDATE FORM
         ======================= -->
    <form 
      class="account-update-form" 
      action="/account/update" 
      method="post"
      novalidate
    >
      <p class="form-note"><em>All fields are required.</em></p>

      <!-- First Name -->
      <label for="account_firstname">First Name</label>
      <input
        type="text"
        id="account_firstname"
        name="account_firstname"
        required
        minlength="2"
        value="<%= 
          typeof account_firstname !== 'undefined'
            ? account_firstname
            : (accountData ? accountData.account_firstname : '')
        %>"
      />

      <!-- Last Name -->
      <label for="account_lastname">Last Name</label>
      <input
        type="text"
        id="account_lastname"
        name="account_lastname"
        required
        minlength="2"
        value="<%= 
          typeof account_lastname !== 'undefined'
            ? account_lastname
            : (accountData ? accountData.account_lastname : '')
        %>"
      />

      <!-- Email -->
      <label for="account_email">Email</label>
      <input
        type="email"
        id="account_email"
        name="account_email"
        required
        value="<%= 
          typeof account_email !== 'undefined'
            ? account_email
            : (accountData ? accountData.account_email : '')
        %>"
      />

      <!-- Hidden account_id -->
      <input
        type="hidden"
        name="account_id"
        value="<%= accountData ? accountData.account_id : '' %>"
      />

      <button type="submit" class="btn-primary">
        Save Account Changes
      </button>
    </form>
  </section>

  <section class="account-update-panel">
    <!-- =======================
         2) CHANGE PASSWORD FORM
         ======================= -->
    <h2>Change Password</h2>

    <p class="password-hint">
      Entering a new password here will replace your current password.
      Your password must be at least 8 characters and include:
      an uppercase letter, a lowercase letter, a number, and a special character.
    </p>

    <form 
      class="password-change-form" 
      action="/account/update-password" 
      method="post"
      novalidate
    >
      <label for="account_password">New Password</label>
      <div class="password-wrapper">
      <input
        type="password"
        id="account_password"
        name="account_password"
        required
        minlength="8"
        pattern="(?=.*\\d)(?=.*[a-z])(?=.*[A-Z])(?=.*\\W).{8,}"
      />

      <button 
        type="button" 
        id="togglePassword" 
        class="show-password-btn"
        aria-pressed="false"
        aria-label="Show password"
      >
        Show
      </button>
    </div>

    <!-- Hidden account_id -->
    <input
      type="hidden"
      name="account_id"
      value="<%= accountData ? accountData.account_id : '' %>"
    />

    <button type="submit" class="update-btn">
      Change Password
    </button>
  </form>
  </section>

<script>
  (function () {
    const passwordInput = document.getElementById("account_password");
    const toggleBtn = document.getElementById("togglePassword");

    if (!passwordInput || !toggleBtn) return;

    toggleBtn.addEventListener("click", function () {
      const isPassword = passwordInput.getAttribute("type") === "password";
      passwordInput.setAttribute("type", isPassword ? "text" : "password");
      this.textContent = isPassword ? "Hide" : "Show";
      this.setAttribute("aria-pressed", String(isPassword));
      this.setAttribute("aria-label", isPassword ? "Hide password" : "Show password");
    });
  })();
</script>
</main>